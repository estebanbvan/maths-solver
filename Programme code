import tkinter as tk
from tkinter import messagebox
import sympy as sp
import matplotlib.pyplot as plt
import numpy as np

# Функция для решения арифметических задач
def solve_arithmetic_problem(problem):
    try:
        result = eval(problem)
        return result
    except Exception as e:
        return f"Ошибка: {e}"

# Функция для решения уравнений
def solve_equation(equation):
    try:
        x = sp.symbols('x')
        expr = sp.sympify(equation)
        solutions = sp.solve(expr, x)
        return solutions
    except Exception as e:
        return f"Ошибка: {e}"

# Функция для нахождения производной
def find_derivative(function):
    try:
        x = sp.symbols('x')
        expr = sp.sympify(function)
        derivative = sp.diff(expr, x)
        return derivative
    except Exception as e:
        return f"Ошибка: {e}"

# Функция для нахождения интеграла
def find_integral(function, definite=False, a=None, b=None):
    try:
        x = sp.symbols('x')
        expr = sp.sympify(function)
        if definite:
            integral = sp.integrate(expr, (x, a, b))
        else:
            integral = sp.integrate(expr, x)
        return integral
    except Exception as e:
        return f"Ошибка: {e}"

# Функция для построения графиков
def plot_graph(function):
    try:
        x = sp.symbols('x')
        expr = sp.sympify(function)
        f = sp.lambdify(x, expr, 'numpy')

        x_vals = np.linspace(-10, 10, 400)
        y_vals = f(x_vals)

        plt.figure(figsize=(6, 4))
        plt.plot(x_vals, y_vals, label=f'y = {function}')
        plt.axhline(0, color='black', linewidth=0.5)
        plt.axvline(0, color='black', linewidth=0.5)
        plt.title(f'График функции y = {function}')
        plt.xlabel('x')
        plt.ylabel('y')
        plt.grid(True, linestyle='--', linewidth=0.5)
        plt.legend()
        plt.show()
    except Exception as e:
        messagebox.showerror("Ошибка", f"Не удалось построить график: {e}")

# Функции для обработки событий кнопок
def on_calculate():
    problem = entry.get()
    if '=' in problem:  
        result = solve_equation(problem)
        result_label.config(text=f"Решение уравнения: {result}")
    else:  
        result = solve_arithmetic_problem(problem)
        result_label.config(text=f"Результат: {result}")

def on_derivative():
    function = entry.get()
    result = find_derivative(function)
    result_label.config(text=f"Производная: {result}")

def on_integral():
    function = entry.get()
    result = find_integral(function)
    result_label.config(text=f"Интеграл: {result}")

def on_definite_integral():
    function = entry.get()
    try:
        a = float(a_entry.get())
        b = float(b_entry.get())
        result = find_integral(function, definite=True, a=a, b=b)
        result_label.config(text=f"Определенный интеграл: {result}")
    except ValueError:
        messagebox.showerror("Ошибка", "Введите числовые границы a и b!")

def on_plot():
    function = entry.get()
    plot_graph(function)

# Создание окна
root = tk.Tk()
root.title("Решатель математических задач")
root.geometry("400x500")

# Заголовок
header = tk.Label(root, text="Введите математическое выражение:", font=("Arial", 14))
header.pack(pady=5)

# Поле для ввода
entry = tk.Entry(root, font=("Arial", 14), width=30)
entry.pack(pady=5)

# Кнопки
calculate_button = tk.Button(root, text="Решить", font=("Arial", 12), command=on_calculate)
calculate_button.pack(pady=5)

derivative_button = tk.Button(root, text="Найти производную", font=("Arial", 12), command=on_derivative)
derivative_button.pack(pady=5)

integral_button = tk.Button(root, text="Найти интеграл", font=("Arial", 12), command=on_integral)
integral_button.pack(pady=5)

# Поля для границ определенного интеграла
a_label = tk.Label(root, text="Граница a:", font=("Arial", 12))
a_label.pack()
a_entry = tk.Entry(root, font=("Arial", 12), width=10)
a_entry.pack()

b_label = tk.Label(root, text="Граница b:", font=("Arial", 12))
b_label.pack()
b_entry = tk.Entry(root, font=("Arial", 12), width=10)
b_entry.pack()

definite_integral_button = tk.Button(root, text="Определенный интеграл", font=("Arial", 12), command=on_definite_integral)
definite_integral_button.pack(pady=5)

plot_button = tk.Button(root, text="Построить график", font=("Arial", 12), command=on_plot)
plot_button.pack(pady=5)

# Метка для отображения результатов
result_label = tk.Label(root, text="", font=("Arial", 14), wraplength=380)
result_label.pack(pady=10)

# Запуск интерфейса
root.mainloop()

